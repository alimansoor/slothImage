/**
 * Sloth Image
 * Version: 1.0
 * Description: Image Lazy Load and Resolution Optimization Library
 * Author: Muhammad Ali Mansoor <muhammad.mansoor@live.com>
 * License: MIT
 */

try {
  var images = [],
    selector_desktop = "",
    selector_mobile = "",
    threshold = 300;

  function sanitizeSelector(e) {
    return (
      "." !== (e = e.trim()).charAt(0) && e.length && (e = "." + e),
      "." !== e ? e : ""
    );
  }

  function isElementInViewport(e, t) {
    var o = e.getBoundingClientRect();
    return (
      o.top >= 0 - t &&
      o.left >= 0 &&
      o.bottom <=
      (window.innerHeight || document.documentElement.clientHeight) + t &&
      o.right <= (window.innerWidth || document.documentElement.clientWidth)
    );
  }

  function isElementVisible(e) {
    return 0 !== e.offsetWidth || 0 !== e.offsetHeight;
  }

  function unregisterEvent() {
    document.querySelectorAll("._img-loaded").length === images.length &&
      (console.log("Sloth Image Complete - Event Unregister"),
        window.removeEventListener("scroll", slothImg));
  }

  function slothImg() {
    images.forEach((e) => {
        isElementInViewport(e, threshold) &&
          ((e.src = e.dataset.src || e.src),
            (e.onload = () => e.classList.add("_img-loaded")));
      }),
      unregisterEvent();
  }

  function setMedia(e) {
    e.matches ?
      (console.log("View=Mobile"),
        (images = selector_desktop ?
          document.querySelectorAll("img:not(" + selector_desktop + ")") :
          document.querySelectorAll("img"))) :
      (console.log("View=Desktop"),
        (images = selector_mobile ?
          document.querySelectorAll("img:not(" + selector_mobile + ")") :
          document.querySelectorAll("img"))),
      slothImg(),
      window.addEventListener("scroll", slothImg);
  }

  function slothInit(e = {}) {
    if ((images = document.querySelectorAll("img")).length) {
      var t =
        e.hasOwnProperty("break_point") && "number" == typeof e.break_point ?
        Math.abs(e.break_point) :
        0;
      if (
        ((selector_desktop =
            e.hasOwnProperty("selector_desktop") &&
            "string" == typeof e.selector_desktop ?
            sanitizeSelector(e.selector_desktop) :
            ""),
          (selector_mobile =
            e.hasOwnProperty("selector_mobile") &&
            "string" == typeof e.selector_mobile ?
            sanitizeSelector(e.selector_mobile) :
            ""),
          (threshold =
            e.hasOwnProperty("threshold") && "number" == typeof e.threshold ?
            Math.abs(e.threshold) :
            300),
          t && (selector_desktop || selector_mobile))
      ) {
        var o = window.matchMedia("screen and (max-device-width: " + t + "px)");
        setMedia(o), o.addListener(setMedia);
      } else slothImg(), window.addEventListener("scroll", slothImg);
    }
  }
} catch (e) {
  console.error("sloth image library has recorded an error", e);
}